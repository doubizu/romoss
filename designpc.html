<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>定制页面</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/roomspc.css" />
		<link rel="stylesheet" type="text/css" href="font/font.css"/>
		<script src="js/jquery-1.10.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/dragdealer.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/easeljs-0.8.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/draw.js" type="text/javascript" charset="utf-8"></script>
		<!--[if lt IE 9]>
	      <script src="js/html5shiv.js"></script>
	      <script src="js/respond.min.js"></script>
	    <![endif]-->
	</head>

	<body>
		<img src="img/designpc/logo.png" />
		<div class="container" style="min-width: 1170px;">
			<div class="row">
				<div class="navpath clearfix">
					<div>1.选择产品</div>
					<div class="current">2.进行设计</div>
					<div>3.提交购买</div>
				</div>
			</div>
			<div class="row" style="text-align: right;">
				<ol class="breadcrumb">
					<li>
						<a href="javascript:;" style="outline: none;" data-toggle="modal" data-target="#warning">定制协议</a>
					</li>
					<li>
						<a href="javascript:;">常见问题</a>
					</li>
					<li>
						<a href="javascript:;" id="mydesign">我的作品</a>
					</li>
				</ol>
			</div>
			<div class="row design">
				<canvas id="polymos" width="572px" height="1250px" class="polymos radius-top-left radius-top-right radius-bottom-left radius-bottom-right"></canvas>
				<div class="items">
					<div id="img">选图</div>
					<div id="upload">上传</div>
					<div id="text">文字</div>
					<div id="zoom">缩放</div>
					<div id="rotate">旋转</div>
					<div id="delete">删除</div>
					<input type="file" name="upfile" id="upfile" value="" style="display: none;"/>
				</div>

				<!-- 图片选择窗 -->
				<div class="page imgpage">
					<!-- Nav tabs -->
					<ul class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active">
							<a href="#1" aria-controls="1" role="tab" data-toggle="tab">图片类型</a>
						</li>
						<li role="presentation">
							<a href="#2" aria-controls="2" role="tab" data-toggle="tab">图片类型</a>
						</li>
						<li role="presentation">
							<a href="#3" aria-controls="3" role="tab" data-toggle="tab">图片类型</a>
						</li>
						<li role="presentation">
							<a href="#4" aria-controls="4" role="tab" data-toggle="tab">图片类型</a>
						</li>
						<li role="presentation">
							<i class="glyphicon glyphicon-remove"></i>
						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active row" id="1">
							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/1.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/2.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/3.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/4.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/5.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/6.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/7.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/8.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>
						</div>
						<div role="tabpanel" class="tab-pane row" id="2">
							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/1.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/2.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/3.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/4.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/5.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/6.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/7.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/8.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>
						</div>
						<div role="tabpanel" class="tab-pane row" id="3">
							messages
						</div>
						<div role="tabpanel" class="tab-pane row" id="4">
							settings
						</div>
					</div>
				</div>

				<!-- 我的作品窗 -->
				<div class="page mydesignpage">
					<ul class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active">
							<a href="#pay" aria-controls="pay" role="tab" data-toggle="tab">已购买</a>
						</li>
						<li role="presentation">
							<a href="#nopay" aria-controls="nopay" role="tab" data-toggle="tab">未购买</a>
						</li>
						<li role="presentation">
							<i class="glyphicon glyphicon-remove"></i>
						</li>
					</ul>

					<div class="tab-content">
						<div role="tabpanel" class="tab-pane row active" id="pay">
							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/1.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/2.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/3.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/4.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/5.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/6.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/7.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/8.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>

							<div class="col-xs-6 col-md-3">
								<a href="#" class="thumbnail">
									<img src="img/png/9.png" alt="">
								</a>
							</div>
						</div>

						<div role="tabpanel" class="tab-pane row" id="nopay">
							settings
						</div>
					</div>
				</div>
			
				<!-- 下弹窗  -->
				<div class="dealer"></div>
				
				<!-- 进度条弹窗 -->
				<div class="page upfileprogress">
					<div class="progress">
					  <div class="progress-bar" role="progressbar"></div>
					</div>
				</div>
			</div>
			<div class="row buttonnav">
				<button type="button" class="btn btn-primary">
					<img src="img/designpc/back.png"/>
					返回选择产品
				</button>
				<button type="button" class="btn btn-primary">
					<img src="img/designpc/back.png"/>
					返回重新设计
				</button>
				<button type="button" class="btn btn-primary" id="save">
					<img src="img/designpc/ok.png"/>
					保存作品
				</button>
				<button type="button" class="btn btn-primary">
					<img src="img/designpc/ok.png"/>
					提交购买
				</button>
			</div>

			<!-- 定制协议模态框 -->
			<div class="modal fade warning" id="warning" tabindex="-1" role="dialog" aria-labelledby="定制协议">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title">定制协议</h4>
						</div>
						<div class="modal-body">
							<h4>声明：您明白、确认并且同意，您提交的用于定制的照片（图片）内容必须符合中华人民共和国适用法律的规定，不得侵犯任何第三方的任何权利，一旦违规产生的不良后果将由您自己承担！您的任何侵权行为与本公司没有任何关系，如果因此给本公司造成损失的应负责赔偿。最终解释权归罗马仕所有。</h4> 上传图片要求：
							<ol>
								<li>图片素材仅限JPG格式；</li>
								<li>为保证印刷效果，建议图片不小于2M哦；</li>
								<li>您还可以联系客服，审核您要上传的图片；</li>
							</ol>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">同意</button>
						</div>
					</div>
				</div>
			</div>

			<!-- 文字输入模态框 -->
			<div class="modal fade textmodul" id="inputtext" tabindex="-1" role="dialog" aria-labelledby="定制协议">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title">文本输入</h4>
						</div>
						<div class="modal-body">
							<textarea class="text" autofocus="autofocus" placeholder="请输入文字"></textarea>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">同意</button>
						</div>
					</div>
				</div>
			</div>
		
			<!-- 绽放、旋转模板 -->
			<script type="text/html" id="tmp_zoom">
				<div class="dragdealer" id="dragdealer">
		            <div class="handle blue-bar">
		            	<span class="value"></span>
		            </div>
		        </div>		
			</script>
			
			<!-- 文本选择 -->
			<script type="text/html" id="tmp_textset">
				<form class="form-inline textsetting">
				  <div class="form-group">
				    <label>选择字体:</label>
				    <select class="form-control fontselect">
					  	<option value="Arial">默认</option>
	                	<option>悦变</option>
	                	<option>毛笔行书</option>
	                	<option>古韵</option>
	                	<option>行楷</option>
	                	<option>硬笔行书</option>
	                	<option>几何体</option>
	                	<option>丛台体</option>
	                	<option>炫丽体</option>
	                	<option>刀锋黑草</option>
	                	<option>萝卜体</option>
					</select>
				  </div>
				  <div class="form-group">
				    <label>选择颜色:</label>
				    <input type="color" class="colorselect"/>
				  </div>
				</form> 
			</script>
		</div>
	</body>
	<script type="text/javascript">
		$(function() {
			//初始化canvas  响应设计窗图文切换
			var curdraw = new Draw("polymos");
			curdraw.onchange(function(){
				if( curdraw.current.name.indexOf("text") != -1 ) {
					dealerShow().then(function(){
						$dealer.html($("#tmp_textset").html());
						$dealer.find(".colorselect").change(function(){
							curdraw.setColor($(this).val());
						});
						$dealer.find(".fontselect").change(function(){
							curdraw.setFamily($(this).val());
						});
					});
				} else if ( curdraw.current.name.indexOf("bitmap") != -1 ) {
					dealerHide();
				}
			});
			
			//切换
			$(".navpath div").click(function(){
				$(this).siblings().removeClass("current");
				$(this).addClass("current");
			});
			
			//进入弹出订制协议			
			$("#warning").modal();
			//滑块
			var $dealer = $(".dealer");
			//初始化imgpage
			var $imgpage = $(".imgpage");
			//进度条
			var $progress = $(".upfileprogress");
			//退出图片选择框
			$imgpage.find(".glyphicon-remove").click(function() {
				$imgpage.fadeOut("fast");
			});
			//选择图片
			$imgpage.find(".thumbnail").click(function(){
				//找到图片，读取图片
				var src = $(this).find("img").attr("src");
				loadImg(src).then(function( img ) {
					dealerHide();
					curdraw.addBitmap(img);
					$imgpage.fadeOut("fast");
				});
			});
			
			//初始化我的订制窗口
			var $mydesing = $(".mydesignpage");
			$mydesing.find(".glyphicon-remove").click(function() {
				$mydesing.fadeOut("fast");
			})
			
			//文件选择框
			var $upfile = $("#upfile");
			$upfile.change(function(){
				dealerHide();
				var file = this.files[0];
				//检测输入
                if( file.type == "image/png" || file.type == "image/jpg" || file.type == "image/jpeg" || file.type == "image/gif" ) {
                	readFile( file ).then(function( img ){
                    	curdraw.addBitmap(img);
                    });
                } else {
                	alert("图片格式不正确!");
                }
			});

			//文本输入框
			var $inputtext = $("#inputtext");
			$inputtext.find(".btn-primary").click(function(){
				var $text = $inputtext.find(".text");
				if( $text.val() ) {
					curdraw.addText($text.val());
					$text.val("");
				}
			});
			
			//文本按钮
			$("#text").click(function() {
				$inputtext.modal();
			})

			//选图按钮
			$("#img").click(function() {
				dealerHide();
				$imgpage.fadeIn("fast");
			});
			
			//我的作品按钮
			$("#mydesign").click(function(){
				dealerHide();
				$mydesing.fadeIn("fast");
			});
			
			//上传按钮
			$("#upload").click(function() {
				dealerHide();
				return $upfile.click();
			});
			
			//缩放
			$("#zoom").click(function(){
				if( curdraw.current === null ) {
					return;
				}
				dealerShow().then(function(){
					$dealer.html($("#tmp_zoom").html());
					
					var multiple = 1;
					var width = curdraw.getScale().x;
					if( curdraw.current.name.indexOf("text") != -1 ) {
						multiple = 10; //文字扩大10位
					} else if( width >= 0.8 ) { //图片如小于0.8扩大3倍
						multiple = 3;
					}
					
					new Dragdealer('dragdealer', {
	        			x : width / multiple,
						animationCallback: function(x, y) {
						    $('#dragdealer .value').text(Math.round(x * 100)+"%");
						    curdraw.setScale( x * multiple,x * multiple );
						}
					});
				})
			});
			
			//旋转
			$("#rotate").click(function(){
				if( curdraw.current === null ) {
					return;
				}
				dealerShow().then(function() {
					$dealer.html($("#tmp_zoom").html());
					
					new Dragdealer('dragdealer', {
	        			x : curdraw.getRotation() / 360,
						animationCallback: function(x, y) {
						    $('#dragdealer .value').text(Math.round(x * 100) + "%");
						    curdraw.setRotation(x * 360);
						}
					});
				});
			});
			
			//删除
			$("#delete").click(function() {
				dealerHide();
				curdraw.delete();
			});
			
			//保存
			$("#save").click(function(){
				$progress.fadeIn("fast",function(){
					var i = 0;
					var time = setInterval(function(){
						var temp = i * 10 + "%";
						$progress.find(".progress-bar").css("width",temp).html(temp);
						if( i++ == 10 ) {
							$progress.fadeOut("fast",function(){
								$progress.find(".progress-bar").css("width",0)
								clearInterval(time);
							});
						}
					},200);
					
				});
			});
			
			function dealerShow() {
				var d = $.Deferred();
				
				if( $dealer.css("bottom") == "0px" ) {
					$dealer.clearQueue().queue(function(){
						$(this).css("bottom","-140px").dequeue();
					}).delay(300).queue(function(){
						$(this).css("bottom","0px");
						d.resolve();
					});
				} else {
					$dealer.css("bottom","0px");
					d.resolve();
				}
				
				return d.promise();
			}
			
			function dealerHide() {
				var d = $.Deferred();
				$dealer.clearQueue().queue(function(){
					$dealer.css("bottom","-140px").dequeue();
				}).delay(300).queue(function(){
					d.resolve();
				});
				return d.promise();
			}
			
			function loadImg( src ) {
				var d = $.Deferred();
				
				var img = new Image();
				img.src = src;
				img.onload = function() {
					d.resolve( img );
				}
				
				return d.promise();
			}
			
			function readFile( file ) {
				var d = $.Deferred();
				var fr = new FileReader();
				fr.readAsDataURL( file );
				fr.onload = function() {
					var img = new Image();
		            img.src = fr.result;
		            img.onload = function() {
		                d.resolve( img );
		            }
				}
				return d.promise();
			}
		});
	</script>
</html>